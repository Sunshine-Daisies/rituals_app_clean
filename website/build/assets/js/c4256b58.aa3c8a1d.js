"use strict";(globalThis.webpackChunkrituals_app_docs=globalThis.webpackChunkrituals_app_docs||[]).push([[8146],{4107:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"backend/database","title":"Database Schema","description":"The application uses PostgreSQL as the primary relational database. Below is the comprehensive Entity-Relationship (ER) Diagram representing the full data structure.","source":"@site/docs/backend/database.mdx","sourceDirName":"backend","slug":"/backend/database","permalink":"/rituals_app_clean/docs/backend/database","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Architecture","permalink":"/rituals_app_clean/docs/backend/architecture"},"next":{"title":"Setup & Installation","permalink":"/rituals_app_clean/docs/mobile/setup"}}');var t=i(4848),r=i(8453),a=i(3369);const d={sidebar_position:3},l="Database Schema",o={},c=[{value:"ER Diagram",id:"er-diagram",level:2},{value:"Tables Overview",id:"tables-overview",level:2},{value:"Core Module",id:"core-module",level:3},{value:"Rituals Module",id:"rituals-module",level:3},{value:"Social Module",id:"social-module",level:3},{value:"Gamification Module",id:"gamification-module",level:3},{value:"Features",id:"features",level:3}];function u(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"database-schema",children:"Database Schema"})}),"\n",(0,t.jsxs)(e.p,{children:["The application uses ",(0,t.jsx)(e.strong,{children:"PostgreSQL"})," as the primary relational database. Below is the comprehensive Entity-Relationship (ER) Diagram representing the full data structure."]}),"\n",(0,t.jsx)(e.h2,{id:"er-diagram",children:"ER Diagram"}),"\n",(0,t.jsx)(a.A,{definition:"\nerDiagram\n  %% Core User & Profile\n  USERS ||--|| USER_PROFILES : has\n  USERS ||--o{ DEVICES : owns\n  USERS ||--o{ USER_FCM_TOKENS : has\n  USERS ||--o{ NOTIFICATIONS : receives\n\n  %% Rituals System\n  USERS ||--o{ RITUALS : creates\n  RITUALS ||--o{ RITUAL_STEPS : contains\n  RITUALS ||--o{ RITUAL_LOGS : tracks\n  \n  %% Social & Sharing\n  USERS ||--o{ FRIENDSHIPS : requests\n  USERS ||--o{ FRIENDSHIPS : receives\n  \n  RITUALS ||--o{ SHARED_RITUALS : shared_as\n  USERS ||--o{ SHARED_RITUALS : owns\n  SHARED_RITUALS ||--o{ RITUAL_PARTNERS : includes\n  USERS ||--o{ RITUAL_PARTNERS : joins\n  \n  %% Gamification\n  USERS ||--o{ USER_BADGES : earns\n  BADGES ||--o{ USER_BADGES : awarded_to\n  USERS ||--o{ XP_HISTORY : logs\n  USERS ||--o{ COIN_HISTORY : logs\n  \n  %% Features\n  USERS ||--o{ LLM_USAGE : generates\n  USERS ||--o{ FREEZE_LOGS : uses\n  RITUAL_PARTNERS ||--o{ FREEZE_LOGS : protected_in\n\n  USERS {\n      uuid id PK\n      string email\n      string password_hash\n      timestamp created_at\n  }\n\n  USER_PROFILES {\n      int id PK\n      uuid user_id FK\n      string username\n      int xp\n      int level\n      int coins\n      int freeze_count\n      int longest_streak\n  }\n\n  RITUALS {\n      uuid id PK\n      uuid user_id FK\n      string name\n      string reminder_time\n      text[] reminder_days\n  }\n\n  RITUAL_STEPS {\n      uuid id PK\n      uuid ritual_id FK\n      string title\n      boolean is_completed\n      int order_index\n  }\n\n  RITUAL_LOGS {\n      uuid id PK\n      uuid ritual_id FK\n      int step_index\n      timestamp completed_at\n  }\n\n  SHARED_RITUALS {\n      int id PK\n      uuid ritual_id FK\n      uuid owner_id FK\n      string invite_code\n      boolean is_public\n  }\n\n  RITUAL_PARTNERS {\n      int id PK\n      int shared_ritual_id FK\n      uuid user_id FK\n      string status\n      int current_streak\n  }\n\n  FRIENDSHIPS {\n      int id PK\n      uuid requester_id FK\n      uuid addressee_id FK\n      string status\n  }\n\n  BADGES {\n      int id PK\n      string name\n      string description\n      int xp_reward\n      int coin_reward\n  }\n\n  USER_BADGES {\n      int id PK\n      uuid user_id FK\n      int badge_id FK\n      timestamp earned_at\n  }\n\n  XP_HISTORY {\n      int id PK\n      uuid user_id FK\n      int amount\n      string source\n  }\n\n  COIN_HISTORY {\n      int id PK\n      uuid user_id FK\n      int amount\n      string source\n  }\n\n  LLM_USAGE {\n      uuid id PK\n      uuid user_id FK\n      string model\n      int tokens_in\n      int tokens_out\n  }\n\n  NOTIFICATIONS {\n      int id PK\n      uuid user_id FK\n      string type\n      string title\n      boolean is_read\n  }\n\n  DEVICES {\n      uuid id PK\n      uuid profile_id FK\n      string device_token\n      string platform\n  }\n  \n  USER_FCM_TOKENS {\n      int id PK\n      uuid user_id FK\n      string fcm_token\n  }\n  \n  FREEZE_LOGS {\n      int id PK\n      uuid user_id FK\n      int ritual_partner_id FK\n      int streak_saved\n  }\n"}),"\n",(0,t.jsx)(e.h2,{id:"tables-overview",children:"Tables Overview"}),"\n",(0,t.jsx)(e.h3,{id:"core-module",children:"Core Module"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"users"})}),": Base authentication table."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"user_profiles"})}),": Extended user data including gamification stats (XP, Level, Coins)."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsxs)(e.strong,{children:[(0,t.jsx)(e.code,{children:"devices"})," & ",(0,t.jsx)(e.code,{children:"user_fcm_tokens"})]}),": Manages device tokens for push notifications."]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"rituals-module",children:"Rituals Module"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"rituals"})}),": The main habit definitions."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"ritual_steps"})}),': Sub-tasks within a ritual (e.g., "Put on shoes" for "Run" ritual).']}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"ritual_logs"})}),": History of ritual completions."]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"social-module",children:"Social Module"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"friendships"})}),": Manages friend requests and connections."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"shared_rituals"})}),": Represents a ritual instance that has been shared for multiplayer participation."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"ritual_partners"})}),": Tracks the participants in a shared ritual and their individual streaks."]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"gamification-module",children:"Gamification Module"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsxs)(e.strong,{children:[(0,t.jsx)(e.code,{children:"badges"})," & ",(0,t.jsx)(e.code,{children:"user_badges"})]}),": Achievement system."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsxs)(e.strong,{children:[(0,t.jsx)(e.code,{children:"xp_history"})," & ",(0,t.jsx)(e.code,{children:"coin_history"})]}),": Audit logs for all points earned or spent."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"freeze_logs"})}),': Tracks when a "Streak Freeze" item was used to save a streak.']}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"features",children:"Features"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"llm_usage"})}),": Logs interactions with the AI Assistant for quota and cost tracking."]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:(0,t.jsx)(e.code,{children:"notifications"})}),": Stores in-app notifications history."]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(u,{...n})}):u(n)}}}]);