"use strict";(globalThis.webpackChunkrituals_app_docs=globalThis.webpackChunkrituals_app_docs||[]).push([[3152],{2769:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>c,default:()=>x,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"features/notifications","title":"Push Notifications","description":"Notifications are crucial for habit formation. The Rituals App uses Firebase Cloud Messaging (FCM) for reliable push notifications across all platforms.","source":"@site/docs/features/notifications.md","sourceDirName":"features","slug":"/features/notifications","permalink":"/docs/features/notifications","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"Onboarding Flow","permalink":"/docs/features/onboarding"},"next":{"title":"Profile & Settings","permalink":"/docs/features/profile"}}');var s=n(4848),l=n(8453),r=n(3369);const d={sidebar_position:7},c="Push Notifications",o={},a=[{value:"Notification Types",id:"notification-types",level:2},{value:"Architecture",id:"architecture",level:2},{value:"FCM Token Management",id:"fcm-token-management",level:2},{value:"Token Registration Flow",id:"token-registration-flow",level:3},{value:"Database Schema",id:"database-schema",level:3},{value:"Multi-Device Support",id:"multi-device-support",level:3},{value:"Notification Actions",id:"notification-actions",level:2},{value:"In-App Notifications",id:"in-app-notifications",level:2},{value:"Notification Screen",id:"notification-screen",level:3},{value:"Notification Storage",id:"notification-storage",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Background Service",id:"background-service",level:2}];function h(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"push-notifications",children:"Push Notifications"})}),"\n",(0,s.jsx)(t.p,{children:"Notifications are crucial for habit formation. The Rituals App uses Firebase Cloud Messaging (FCM) for reliable push notifications across all platforms."}),"\n",(0,s.jsx)(t.h2,{id:"notification-types",children:"Notification Types"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Source"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Purpose"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Ritual Reminder"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Scheduled"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Remind user to perform a specific ritual at set time"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Streak Warning"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Backend"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Warn user at 8 PM if they haven't completed their ritual"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Partner Nudge"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Real-time"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Friend manually sends a reminder"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Friend Request"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Real-time"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Notification when someone adds you"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Partnership Invite"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Real-time"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Notification when invited to join a ritual"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Badge Unlock"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Real-time"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Celebration when a new badge is earned"})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(r.A,{definition:"\nflowchart TD\n  subgraph Mobile [Flutter App]\n      App[App Instance]\n      FCMToken[FCM Token]\n      LocalStore[Local Notification Display]\n  end\n  \n  subgraph Backend [Node.js Server]\n      API[API Server]\n      TokenDB[(user_fcm_tokens)]\n      NotifDB[(notifications)]\n  end\n  \n  subgraph Firebase [Firebase Cloud Messaging]\n      FCM[FCM Service]\n  end\n  \n  App --\x3e|Register Token| API\n  API --\x3e|Store| TokenDB\n  \n  API --\x3e|Send Push| FCM\n  FCM --\x3e|Deliver| App\n  App --\x3e|Display| LocalStore\n  \n  API --\x3e|Log| NotifDB\n  \n  style Firebase fill:#ff9800,stroke:#e65100\n  style Backend fill:#4caf50,stroke:#2e7d32\n  style Mobile fill:#2196f3,stroke:#1565c0\n"}),"\n",(0,s.jsx)(t.h2,{id:"fcm-token-management",children:"FCM Token Management"}),"\n",(0,s.jsx)(t.h3,{id:"token-registration-flow",children:"Token Registration Flow"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"User logs in to the app"}),"\n",(0,s.jsx)(t.li,{children:"App requests FCM permission"}),"\n",(0,s.jsx)(t.li,{children:"Firebase returns device token"}),"\n",(0,s.jsxs)(t.li,{children:["Token sent to backend: ",(0,s.jsx)(t.code,{children:"POST /api/notifications/fcm-token"})]}),"\n",(0,s.jsxs)(t.li,{children:["Token stored in ",(0,s.jsx)(t.code,{children:"user_fcm_tokens"})," table"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"database-schema",children:"Database Schema"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"CREATE TABLE user_fcm_tokens (\r\n  id SERIAL PRIMARY KEY,\r\n  user_id UUID REFERENCES users(id),\r\n  fcm_token TEXT NOT NULL,\r\n  device_id TEXT,\r\n  created_at TIMESTAMP DEFAULT NOW(),\r\n  updated_at TIMESTAMP DEFAULT NOW(),\r\n  UNIQUE(user_id, fcm_token)\r\n);\n"})}),"\n",(0,s.jsx)(t.h3,{id:"multi-device-support",children:"Multi-Device Support"}),"\n",(0,s.jsx)(t.p,{children:"Users can be logged in on multiple devices. Each device registers its own FCM token, and notifications are sent to all active tokens."}),"\n",(0,s.jsx)(t.h2,{id:"notification-actions",children:"Notification Actions"}),"\n",(0,s.jsxs)(t.p,{children:["Some notifications support ",(0,s.jsx)(t.strong,{children:"actionable buttons"}),":"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Notification"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Actions"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Ritual Reminder"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"[Complete] [Snooze]"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Partner Nudge"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"[View Ritual] [Dismiss]"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Partnership Invite"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"[Accept] [Decline]"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Friend Request"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"[Accept] [View Profile]"})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"in-app-notifications",children:"In-App Notifications"}),"\n",(0,s.jsx)(t.p,{children:"Beyond push notifications, the app maintains an in-app notification center:"}),"\n",(0,s.jsx)(t.h3,{id:"notification-screen",children:"Notification Screen"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Access via bell icon in header"}),"\n",(0,s.jsx)(t.li,{children:"Unread badge count"}),"\n",(0,s.jsx)(t.li,{children:"List of all notifications (read/unread)"}),"\n",(0,s.jsx)(t.li,{children:"Tap to navigate to relevant screen"}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"notification-storage",children:"Notification Storage"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"CREATE TABLE notifications (\r\n  id SERIAL PRIMARY KEY,\r\n  user_id UUID REFERENCES users(id),\r\n  type VARCHAR(50) NOT NULL,\r\n  title VARCHAR(200),\r\n  body TEXT,\r\n  data JSONB,\r\n  is_read BOOLEAN DEFAULT FALSE,\r\n  created_at TIMESTAMP DEFAULT NOW()\r\n);\n"})}),"\n",(0,s.jsx)(t.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(t.p,{children:"Users can customize preferences in Settings:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Setting"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Options"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Push Enabled"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"On / Off"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Sound"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"On / Off"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Streak Warnings"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"On / Off"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Partner Nudges"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"On / Off"})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"background-service",children:"Background Service"}),"\n",(0,s.jsxs)(t.p,{children:["The Flutter app uses a ",(0,s.jsx)(t.strong,{children:"background service"})," to:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"Handle notifications when app is closed"}),"\n",(0,s.jsx)(t.li,{children:"Process notification taps"}),"\n",(0,s.jsx)(t.li,{children:"Navigate to correct screen on tap"}),"\n"]})]})}function x(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);