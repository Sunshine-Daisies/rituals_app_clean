"use strict";(globalThis.webpackChunkrituals_app_docs=globalThis.webpackChunkrituals_app_docs||[]).push([[6699],{4159:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>c,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"backend/architecture","title":"Architecture","description":"The backend is a RESTful API built with Node.js and Express, written in TypeScript. It follows a Service-Controller pattern to separate concerns and ensure maintainability.","source":"@site/docs/backend/architecture.md","sourceDirName":"backend","slug":"/backend/architecture","permalink":"/docs/backend/architecture","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Setup & Installation","permalink":"/docs/backend/setup"},"next":{"title":"Database Schema","permalink":"/docs/backend/database"}}');var t=r(4848),i=r(8453),a=r(3369);const c={sidebar_position:2},l="Architecture",d={},o=[{value:"High-Level Overview",id:"high-level-overview",level:2},{value:"Layered Architecture",id:"layered-architecture",level:2},{value:"1. Presentation Layer (Controllers &amp; Routes)",id:"1-presentation-layer-controllers--routes",level:3},{value:"2. Business Logic Layer (Services)",id:"2-business-logic-layer-services",level:3},{value:"3. Data Access Layer",id:"3-data-access-layer",level:3},{value:"Background Processes",id:"background-processes",level:2},{value:"Tech Stack",id:"tech-stack",level:2}];function h(e){const s={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,t.jsxs)(s.p,{children:["The backend is a ",(0,t.jsx)(s.strong,{children:"RESTful API"})," built with ",(0,t.jsx)(s.strong,{children:"Node.js"})," and ",(0,t.jsx)(s.strong,{children:"Express"}),", written in ",(0,t.jsx)(s.strong,{children:"TypeScript"}),". It follows a ",(0,t.jsx)(s.strong,{children:"Service-Controller"})," pattern to separate concerns and ensure maintainability."]}),"\n",(0,t.jsx)(s.h2,{id:"high-level-overview",children:"High-Level Overview"}),"\n",(0,t.jsx)(s.p,{children:"The system is designed to be stateless and scalable, integrating with PostgreSQL for data and Firebase for notifications."}),"\n",(0,t.jsx)(a.A,{definition:"\nflowchart LR\n  Client[Mobile App] --\x3e|HTTP Requests| API[Express API]\n  \n  subgraph Backend [Backend Server]\n      API --\x3e Auth[Auth Middleware]\n      Auth --\x3e Router[Router]\n      Router --\x3e Controller[Controllers]\n      Controller --\x3e Service[Services]\n  end\n  \n  Service --\x3e|SQL| DB[(PostgreSQL)]\n  Service --\x3e|Push Notif| FCM[Firebase Cloud Messaging]\n  Service --\x3e|Email| SMTP[Nodemailer]\n  \n  Cron[Cron Jobs] --\x3e|Scheduled Tasks| Service\n  \n  style Backend fill:#f5f5f5,stroke:#333,stroke-dasharray: 5 5\n  style DB fill:#bbf,stroke:#333,stroke-width:2px\n  style FCM fill:#ffcc80,stroke:#e65100\n"}),"\n",(0,t.jsx)(s.h2,{id:"layered-architecture",children:"Layered Architecture"}),"\n",(0,t.jsx)(s.p,{children:'We strictly separate the "how" (HTTP handling) from the "what" (Business Logic).'}),"\n",(0,t.jsx)(a.A,{definition:'\nclassDiagram\n  class Controller {\n      +handleRequest(req, res)\n      +validateInput()\n      +sendResponse()\n  }\n  \n  class Service {\n      +executeBusinessLogic()\n      +calculateStats()\n      +triggerNotifications()\n  }\n  \n  class Database {\n      +query(sql, params)\n      +pool\n  }\n\n  Controller --\x3e Service : Calls\n  Service --\x3e Database : Queries\n  \n  note for Controller "Layer: Presentation\nHandles HTTP, JSON, Status Codes"\n  note for Service "Layer: Business Logic\nPure logic, reusable, throws Errors"\n  note for Database "Layer: Data Access\nRaw SQL / Query Builder"\n'}),"\n",(0,t.jsx)(s.h3,{id:"1-presentation-layer-controllers--routes",children:"1. Presentation Layer (Controllers & Routes)"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Routes:"})," Define the API endpoints (e.g., ",(0,t.jsx)(s.code,{children:"POST /rituals"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Controllers:"})," Extract data from requests (",(0,t.jsx)(s.code,{children:"req.body"}),", ",(0,t.jsx)(s.code,{children:"req.user"}),"), call the appropriate service, and format the response. They do ",(0,t.jsx)(s.em,{children:"not"})," contain business logic."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"2-business-logic-layer-services",children:"2. Business Logic Layer (Services)"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Services:"})," Contain the core application logic. For example, ",(0,t.jsx)(s.code,{children:"RitualService"})," handles creating a ritual, validating limits, and scheduling initial reminders."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Independence:"})," Services don't know about HTTP. They accept parameters and return data or throw errors."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"3-data-access-layer",children:"3. Data Access Layer"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"PostgreSQL:"})," We use raw SQL queries (via ",(0,t.jsx)(s.code,{children:"pg"})," pool) for maximum control and performance."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Migrations:"})," Database schema changes are managed via SQL scripts."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"background-processes",children:"Background Processes"}),"\n",(0,t.jsxs)(s.p,{children:["We use ",(0,t.jsx)(s.code,{children:"node-cron"})," for scheduled tasks that run independently of user requests."]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Streak Scheduler:"})," Runs daily at midnight to check for missed rituals and reset streaks."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Notification Scheduler:"})," Checks for upcoming ritual reminders and sends push notifications via Firebase."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"tech-stack",children:"Tech Stack"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Category"}),(0,t.jsx)(s.th,{children:"Technology"}),(0,t.jsx)(s.th,{children:"Purpose"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Runtime"})}),(0,t.jsx)(s.td,{children:"Node.js"}),(0,t.jsx)(s.td,{children:"Server-side JavaScript runtime"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Language"})}),(0,t.jsx)(s.td,{children:"TypeScript"}),(0,t.jsx)(s.td,{children:"Type safety and modern features"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Framework"})}),(0,t.jsx)(s.td,{children:"Express.js"}),(0,t.jsx)(s.td,{children:"Web server framework"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Database"})}),(0,t.jsx)(s.td,{children:"PostgreSQL"}),(0,t.jsx)(s.td,{children:"Relational database"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Auth"})}),(0,t.jsx)(s.td,{children:"JWT (jsonwebtoken)"}),(0,t.jsx)(s.td,{children:"Stateless authentication"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Scheduling"})}),(0,t.jsx)(s.td,{children:"node-cron"}),(0,t.jsx)(s.td,{children:"Scheduled tasks"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Push Notif"})}),(0,t.jsx)(s.td,{children:"Firebase Admin"}),(0,t.jsx)(s.td,{children:"Sending FCM messages"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.strong,{children:"Docs"})}),(0,t.jsx)(s.td,{children:"Swagger (OpenAPI)"}),(0,t.jsx)(s.td,{children:"API Documentation"})]})]})]})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);